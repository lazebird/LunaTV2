# LunaTV æºä»£ç ç»“æ„è¯´æ˜

## ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/                    # Next.js App Router (è·¯ç”±å…¥å£å±‚)
â”‚   â”œâ”€â”€ api/                # API è·¯ç”±å…¥å£
â”‚   â”œâ”€â”€ (pages)/            # é¡µé¢è·¯ç”±å…¥å£
â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€
â”‚   â””â”€â”€ page.tsx            # é¦–é¡µ
â”‚
â”œâ”€â”€ frontend/               # å‰ç«¯ä»£ç  (UIå±‚)
â”‚   â”œâ”€â”€ app/                # é¡µé¢ç»„ä»¶å®ç°
â”‚   â”‚   â”œâ”€â”€ (auth)/         # è®¤è¯é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ (content)/      # å†…å®¹æµè§ˆé¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ (media)/        # åª’ä½“æ’­æ”¾é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ (admin)/        # ç®¡ç†åå°é¡µé¢ç»„
â”‚   â”‚   â”œâ”€â”€ (stats)/        # ç»Ÿè®¡åˆ†æé¡µé¢ç»„
â”‚   â”‚   â””â”€â”€ (integration)/  # ç¬¬ä¸‰æ–¹é›†æˆé¡µé¢ç»„
â”‚   â”œâ”€â”€ components/         # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ layout/         # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ media/          # åª’ä½“ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ content/        # å†…å®¹å±•ç¤ºç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ search/         # æœç´¢ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ user/           # ç”¨æˆ·ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ admin/          # ç®¡ç†åå°ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ live/           # ç›´æ’­ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ selectors/      # é€‰æ‹©å™¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ modals/         # æ¨¡æ€æ¡†ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ providers/      # Context Providers
â”‚   â”‚   â””â”€â”€ ui/             # åŸºç¡€ UI ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/              # React Hooks
â”‚   â”œâ”€â”€ styles/             # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ types/              # å‰ç«¯ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ backend/                # åç«¯ä»£ç  (ä¸šåŠ¡é€»è¾‘å±‚)
â”‚   â”œâ”€â”€ api/                # API è·¯ç”±å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ media/          # åª’ä½“ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ content/        # å†…å®¹èšåˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ live/           # ç›´æ’­æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ admin/          # ç®¡ç†åå°æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ integration/    # ç¬¬ä¸‰æ–¹é›†æˆæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ proxy/          # ä»£ç†æœåŠ¡æ¨¡å—
â”‚   â”‚   â””â”€â”€ utils/          # API å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ media/          # åª’ä½“æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ content/        # å†…å®¹æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ live/           # ç›´æ’­æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ admin/          # ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ integration/    # é›†æˆæœåŠ¡
â”‚   â”œâ”€â”€ data/               # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ storage/        # å­˜å‚¨å®ç°
â”‚   â”‚   â”œâ”€â”€ cache/          # ç¼“å­˜ç®¡ç†
â”‚   â”‚   â””â”€â”€ repositories/   # æ•°æ®ä»“åº“
â”‚   â”œâ”€â”€ clients/            # å¤–éƒ¨ API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ types/              # åç«¯ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ config/             # é…ç½®ç®¡ç†
â”‚
â”œâ”€â”€ shared/                 # å‰åç«¯å…±äº«ä»£ç 
â”‚   â”œâ”€â”€ types/              # å…±äº«ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ constants/          # å…±äº«å¸¸é‡
â”‚   â””â”€â”€ utils/              # å…±äº«å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ components/             # [æ—§] åŸå§‹ç»„ä»¶ç›®å½• (å¾…è¿ç§»)
â”œâ”€â”€ hooks/                  # [æ—§] åŸå§‹ hooks ç›®å½• (å¾…è¿ç§»)
â”œâ”€â”€ lib/                    # [æ—§] åŸå§‹ lib ç›®å½• (å¾…è¿ç§»)
â”œâ”€â”€ modules/                # [æ—§] åŸå§‹ modules ç›®å½• (å¾…è¿ç§»)
â”œâ”€â”€ styles/                 # [æ—§] åŸå§‹æ ·å¼ç›®å½• (å¾…è¿ç§»)
â”œâ”€â”€ types/                  # [æ—§] åŸå§‹ç±»å‹ç›®å½• (å¾…è¿ç§»)
â””â”€â”€ middleware.ts           # Next.js ä¸­é—´ä»¶
```

## æ¶æ„è¯´æ˜

### ä¸‰å±‚æ¶æ„

1. **è·¯ç”±å…¥å£å±‚ (src/app/)**
   - Next.js App Router è¦æ±‚çš„ç›®å½•ç»“æ„
   - ä»…ä½œä¸ºè·¯ç”±å…¥å£ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
   - é¡µé¢å’Œ API è·¯ç”±å¯¼å…¥å®é™…å®ç°

2. **å‰ç«¯ UI å±‚ (src/frontend/)**
   - æ‰€æœ‰ React ç»„ä»¶å’Œé¡µé¢å®ç°
   - Hooksã€æ ·å¼ã€å‰ç«¯ç±»å‹å®šä¹‰
   - çº¯å‰ç«¯ä»£ç ï¼Œä¸åŒ…å«æœåŠ¡ç«¯é€»è¾‘

3. **åç«¯ä¸šåŠ¡å±‚ (src/backend/)**
   - API å¤„ç†å™¨ã€ä¸šåŠ¡æœåŠ¡ã€æ•°æ®è®¿é—®
   - å¤–éƒ¨å®¢æˆ·ç«¯ã€å·¥å…·å‡½æ•°ã€ä¸­é—´ä»¶
   - çº¯åç«¯ä»£ç ï¼Œä¸åŒ…å« UI ç»„ä»¶

4. **å…±äº«å±‚ (src/shared/)**
   - å‰åç«¯å…±äº«çš„ç±»å‹å®šä¹‰
   - å…±äº«å¸¸é‡å’Œå·¥å…·å‡½æ•°
   - ç¡®ä¿å‰åç«¯ç±»å‹ä¸€è‡´

### è·¯å¾„åˆ«å

åœ¨ `tsconfig.json` ä¸­é…ç½®äº†ä»¥ä¸‹è·¯å¾„åˆ«åï¼š

```json
{
  "@/*": ["./src/*"],
  "@frontend/*": ["./src/frontend/*"],
  "@backend/*": ["./src/backend/*"],
  "@shared/*": ["./src/shared/*"],
  "@components/*": ["./src/frontend/components/*"],
  "@hooks/*": ["./src/frontend/hooks/*"],
  "@services/*": ["./src/backend/services/*"],
  "@api/*": ["./src/backend/api/*"],
  "@utils/*": ["./src/backend/utils/*"],
  "~/*": ["./public/*"]
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### å‰ç«¯ç»„ä»¶å¯¼å…¥

```typescript
// å¯¼å…¥ç»„ä»¶
import { VideoCard } from '@components/media/VideoCard';
import { UserMenu } from '@components/layout/UserMenu';

// å¯¼å…¥ Hooks
import { useUserData } from '@hooks/useUserData';

// å¯¼å…¥å…±äº«ç±»å‹
import { User, PlayRecord } from '@shared/types';
import { ROUTES } from '@shared/constants';
```

#### åç«¯æœåŠ¡å¯¼å…¥

```typescript
// å¯¼å…¥æœåŠ¡
import { AuthService } from '@services/auth/auth.service';
import { SearchService } from '@services/media/search.service';

// å¯¼å…¥å­˜å‚¨
import { getStorage } from '@backend/data/storage/base.storage';

// å¯¼å…¥å®¢æˆ·ç«¯
import { DoubanClient } from '@backend/clients/douban.client';

// å¯¼å…¥å…±äº«ç±»å‹
import { User, ApiResponse } from '@shared/types';
```

#### API è·¯ç”±é€‚é…

```typescript
// src/app/api/login/route.ts (è·¯ç”±å…¥å£)
import { AuthService } from '@services/auth/auth.service';

export async function POST(request: Request) {
  const authService = new AuthService();
  return authService.login(request);
}
```

## è¿ç§»çŠ¶æ€

### âœ… å·²å®Œæˆ

- [x] åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
- [x] æ›´æ–° TypeScript é…ç½®
- [x] åˆ›å»ºå…±äº«ç±»å‹å®šä¹‰
- [x] åˆ›å»ºå…±äº«å¸¸é‡
- [x] å¤åˆ¶å­˜å‚¨å±‚æ–‡ä»¶
- [x] å¤åˆ¶å¤–éƒ¨å®¢æˆ·ç«¯æ–‡ä»¶
- [x] å¤åˆ¶å·¥å…·å‡½æ•°
- [x] å¤åˆ¶å‰ç«¯ç»„ä»¶
- [x] å¤åˆ¶ Hooks å’Œæ ·å¼

### â³ è¿›è¡Œä¸­

- [ ] æ›´æ–°ç»„ä»¶å¯¼å…¥è·¯å¾„
- [ ] è¿ç§» API è·¯ç”±é€»è¾‘
- [ ] è¿ç§»é¡µé¢ç»„ä»¶
- [ ] æå–ä¸šåŠ¡æœåŠ¡å±‚

### ğŸ“‹ å¾…å®Œæˆ

- [ ] åˆ é™¤æ—§çš„æ–‡ä»¶ï¼ˆç¡®è®¤æ–°ç»“æ„å·¥ä½œæ­£å¸¸åï¼‰
- [ ] æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
- [ ] å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•
- [ ] æ›´æ–°æ–‡æ¡£

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. **å‰ç«¯ç»„ä»¶**ï¼šæ·»åŠ åˆ° `src/frontend/components/` å¯¹åº”åˆ†ç±»
2. **åç«¯ API**ï¼šæ·»åŠ åˆ° `src/backend/api/` å¯¹åº”æ¨¡å—
3. **ä¸šåŠ¡æœåŠ¡**ï¼šæ·»åŠ åˆ° `src/backend/services/` å¯¹åº”æ¨¡å—
4. **å…±äº«ç±»å‹**ï¼šæ·»åŠ åˆ° `src/shared/types/`

### å¯¼å…¥è§„èŒƒ

- ä½¿ç”¨è·¯å¾„åˆ«åï¼Œä¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„
- å‰ç«¯ä»£ç åªå¯¼å…¥ `@frontend/*` å’Œ `@shared/*`
- åç«¯ä»£ç åªå¯¼å…¥ `@backend/*` å’Œ `@shared/*`
- é¿å…å‰åç«¯ä»£ç äº¤å‰å¯¼å…¥

### æµ‹è¯•éªŒè¯

```bash
# ç±»å‹æ£€æŸ¥
pnpm typecheck

# æ„å»ºæµ‹è¯•
pnpm build

# å¼€å‘æ¨¡å¼
pnpm dev
```

## æ³¨æ„äº‹é¡¹

1. **ä¿æŒå…¼å®¹æ€§**ï¼šè¿ç§»è¿‡ç¨‹ä¸­ä¿æŒç°æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **æ¸è¿›å¼è¿ç§»**ï¼šé€æ­¥è¿ç§»ï¼Œä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰æ–‡ä»¶
3. **è·¯å¾„åˆ«å**ï¼šç»Ÿä¸€ä½¿ç”¨æ–°çš„è·¯å¾„åˆ«å
4. **ç±»å‹å®‰å…¨**ï¼šç¡®ä¿ TypeScript ç¼–è¯‘æ— é”™è¯¯
5. **åŠŸèƒ½æµ‹è¯•**ï¼šæ¯æ¬¡è¿ç§»åéƒ½è¦æµ‹è¯•ç›¸å…³åŠŸèƒ½

## ç›¸å…³æ–‡æ¡£

- [REFACTOR_PLAN.md](../REFACTOR_PLAN.md) - å®Œæ•´é‡æ„è®¡åˆ’
- [QUICK_START_REFACTOR.md](../QUICK_START_REFACTOR.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- [MIGRATION_GUIDE.md](../MIGRATION_GUIDE.md) - è¯¦ç»†è¿ç§»æŒ‡å—
